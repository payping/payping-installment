# راهنمای رفع مشکل افزونه پرداخت اقساطی پی‌پینگ

## مشکل: افزونه در بخش درگاه‌های پرداخت ووکامرس ظاهر نمی‌شود

### بررسی‌های اولیه:

1. **ووکامرس فعال باشد**: از فعال بودن افزونه ووکامرس اطمینان حاصل کنید
2. **افزونه پی‌پینگ فعال باشد**: از فعال بودن افزونه پی‌پینگ اقساطی اطمینان حاصل کنید
3. **توکن وارد شده باشد**: ⭐ **این مهم ترین موضوع است!** 
   - به پیشخوان وردپرس > پرداخت اقساطی > تنظیمات بروید
   - توکن API پی‌پینگ خود را در فیلد مربوطه وارد کنید
   - **بدون توکن، درگاه در ووکامرس ظاهر نخواهد شد**

### استفاده از فایل تست:

1. فایل `debug-test.php` را در ریشه سایت وردپرس خود کپی کنید
2. به آدرس `yoursite.com/debug-test.php` مراجعه کنید
3. نتایج را بررسی کنید

### اقدامات انجام شده برای رفع مشکل:

#### 1. بهبود تشخیص ووکامرس
- روش تشخیص افزونه ووکامرس بهبود یافته است
- از تابع `is_plugin_active` وردپرس به عنوان fallback استفاده می‌شود

#### 2. تغییر زمان فعال‌سازی
- Hook فعال‌سازی از `init` به `plugins_loaded` تغییر یافت
- این باعث می‌شود افزونه زودتر بارگیری شود

#### 3. بارگیری توابع مدیریتی
- تابع `is_plugin_active` به صورت اتوماتیک بارگیری می‌شود

#### 4. افزودن Debug Logging
- پیام‌های debug به لاگ وردپرس اضافه شده‌اند
- برای فعال کردن debug logging، کدهای زیر را به `wp-config.php` اضافه کنید:

```php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
define('WP_DEBUG_DISPLAY', false);
```

سپس فایل `wp-content/debug.log` را بررسی کنید.

### نحوه بررسی لاگ‌ها:

پیام‌هایی با شروع "PayPing Installment:" در لاگ debug دنبال کنید:

- `PayPing Installment: Gateway init method called` - اگر این پیام موجود نباشد، افزونه اصلاً بارگیری نمی‌شود
- `PayPing Installment: WooCommerce detected as active/inactive` - وضعیت تشخیص ووکامرس
- `PayPing Installment: Adding WooCommerce hooks` - اگر این پیام موجود باشد، hook ها اضافه شده‌اند
- `PayPing Installment: Adding gateway to WooCommerce payment methods` - اگر این پیام موجود باشد، درگاه به ووکامرس اضافه شده
- `PayPing Installment: Gateway not available - Token is empty` - اگر این پیام موجود باشد، توکن تنظیم نشده
- `PayPing Installment: Gateway availability check - Token OK` - توکن درست تنظیم شده و درگاه باید available باشد

### راه‌حل‌های احتمالی دیگر:

1. **پاک کردن کش**: کش افزونه‌ها و سایت را پاک کنید
2. **بررسی تداخل افزونه‌ها**: سایر افزونه‌ها را موقتاً غیرفعال کنید
3. **بررسی تم**: تم را موقتاً به تم پیش‌فرض تغییر دهید
4. **بررسی PHP errors**: لاگ خطاهای PHP را بررسی کنید

### تماس با پشتیبانی:

اگر مشکل همچنان ادامه دارد، لطفاً موارد زیر را همراه درخواست پشتیبانی ارسال کنید:

1. نتیجه فایل `debug-test.php`
2. محتوای فایل `debug.log` (قسمت‌های مربوط به PayPing)
3. لیست افزونه‌های فعال
4. نسخه وردپرس و ووکامرس

---

**نکته**: پس از اعمال تغییرات، حتماً افزونه را یک بار غیرفعال و مجدداً فعال کنید.